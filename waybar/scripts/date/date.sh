#!/bin/bash

export LC_TIME="ru_RU.UTF-8"
export LANG="ru_RU.UTF-8"

# Получаем текущее время и дату с ручным переводом дней недели и месяцев через sed.
# Это обеспечивает точное соответствие формату "Пн", "Вт" и т.д., а также русские названия месяцев.
# Локаль для 'date' будет использоваться системная по умолчанию, но sed переведет нужные части.
time=$(date '+%H:%M %a, %d %b %Y')

# Получаем календарь текущего месяца, явно указывая локаль 'ru_RU.koi8r' для команды 'cal'.
# Это должно обеспечить вывод календаря на русском языке, так как эта локаль присутствует в вашей системе.
calendar=$(cal -m)

# Удаляем кавычки и экранируем переносы строк для корректного отображения в JSON.
calendar_escaped=$(echo "$calendar" | sed ':a;N;$!ba;s/\n/\\n/g')

# Выводим результат в формате JSON.
echo "{\"text\": \"$time\", \"tooltip\": \"$calendar_escaped\"}"
